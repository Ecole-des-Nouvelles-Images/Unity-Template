name: Acquire and Upload Unity Activation File

on:
  workflow_dispatch: {}

jobs:
  request_activation_file:
    name: Request Manual Activation File
    runs-on: ubuntu-latest
    outputs:
      alf_file: ${{ steps.get_activation.outputs.filePath }}
    steps:
      - name: Request manual activation file
        id: get_activation
        uses: game-ci/unity-request-activation-file@v2

      - name: Debug filePath output
        run: echo "Generated .alf file at ${{ steps.get_activation.outputs.filePath }}"

      - name: List files for debugging
        run: |
          ls -la
          ls -la $(dirname ${{ steps.get_activation.outputs.filePath }})

      - name: Upload Unity Activation File Artifact
        uses: actions/upload-artifact@v3
        with:
          name: Unity_Activation_File
          path: ${{ steps.get_activation.outputs.filePath }}

  upload_activation_file:
    name: Upload Activation File (Manual Step)
    needs: request_activation_file
    runs-on: ubuntu-latest
    steps:
      - name: Download Unity Activation File Artifact
        uses: actions/download-artifact@v3
        with:
          name: Unity_Activation_File

      - name: Show downloaded file
        run: |
          echo "Downloaded Unity Activation File:"
          ls -la Unity_Activation_File

      - name: Reminder - Upload manually to Unity website
        run: |
          echo "Upload the .alf file to Unity Manual Activation: https://license.unity3d.com/manual"
          echo "Then retrieve the .ulf file and set it as the UNITY_LICENSE secret."
